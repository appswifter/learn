{"version":3,"file":"my-single-spa.js","sources":["../../src/applications/timeouts.js","../../src/applications/app.helper.js","../../src/start.js","../../src/lifecycles/bootstrap.js","../../src/lifecycles/unmount.js","../../src/lifecycles/mount.js","../../src/lifecycles/update.js","../../src/services/index.js","../../src/lifecycles/helper.js","../../src/lifecycles/load.js","../../src/navigation/hijackLocations.js","../../src/navigation/invoke.js","../../src/applications/apps.js"],"sourcesContent":["const DEFAULT_TIMEOUTS = {\n  bootstrap: {\n      // 超时毫秒数\n      milliseconds: 3000,\n      // 当超时，是否\n      rejectWhenTimeout: false\n  },\n  mount: {\n      // 超时毫秒数\n      milliseconds: 3000,\n      // 当超时，是否\n      rejectWhenTimeout: false\n  },\n  unmount: {\n      // 超时毫秒数\n      milliseconds: 3000,\n      // 当超时，是否\n      rejectWhenTimeout: false\n  },\n  unload: {\n      // 超时毫秒数\n      milliseconds: 3000,\n      // 当超时，是否\n      rejectWhenTimeout: false\n  }\n};\n\nexport function setBootstrapMaxTime(milliseconds, rejectWhenTimeout = false) {\n  if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n    throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n  }\n\n  DEFAULT_TIMEOUTS.bootstrap = { milliseconds, rejectWhenTimeout }\n}\n\nexport function setMountMaxTime(milliseconds, rejectWhenTimeout = false) {\n  if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n      throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n  }\n  DEFAULT_TIMEOUTS.mount = {milliseconds, rejectWhenTimeout};\n}\n\nexport function setUnmountMaxTime(milliseconds, rejectWhenTimeout = false) {\n  if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n      throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n  }\n  DEFAULT_TIMEOUTS.unmount = {milliseconds, rejectWhenTimeout};\n}\n\nexport function setUnloadMaxTime(milliseconds, rejectWhenTimeout = false) {\n  if (typeof milliseconds !== 'number' || milliseconds <= 0) {\n      throw new Error(`${type} max time must be a positive integer number of milliseconds`);\n  }\n  DEFAULT_TIMEOUTS.unload = {milliseconds, rejectWhenTimeout};\n}\n\nexport function ensureAppTimeouts(timeouts = {}) {\n  return {\n      ...DEFAULT_TIMEOUTS,\n      ...timeouts\n  }\n}\n\nexport function reasonableTime(promise, description, timeouts) {\n  return new Promise((resolve, reject) => {\n    let finished = false\n    \n    promise.then(data => {\n      finished = true\n      resolve(data)\n    }).catch(e => {\n      finished = true\n      reject(e)\n    })\n\n    setTimeout(maybeTimeout, timeouts.milliseconds)\n    \n    function maybeTimeout() {\n      if (finished) return\n      let error = `${description} did not resolve or reject for ${timeouts.milliseconds} milliseconds`;\n      if (timeouts.rejectWhenTimeout) {\n          reject(new Error(error));\n      } else {\n          console.error(error);\n      }\n    }\n  })\n}","\n// 未加载\nexport const NOT_LOADED = 'NOT_LOADED';\n// 加载app代码中\nexport const LOAD_RESOURCE_CODE = 'LOAD_RESOURCE_CODE';\n// 加载成功，但为启动\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED';\n// 启动中\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING';\n// 启动成功，未挂载\nexport const NOT_MOUNTED = 'NOT_MOUNTED';\n// 挂载中\nexport const MOUNTING = 'MOUNTING';\n// 挂载成功\nexport const MOUNTED = 'MOUNTED';\n// 卸载中\nexport const UNMOUNTING = 'UNMOUNTING';\n// 加载时参数校验未通过，或非致命错误\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN';\n// 加载时遇到致命错误\nexport const LOAD_ERROR = 'LOAD_ERROR';\n// 更新service中\nexport const UPDATING = 'UPDATING';\n\n\nexport function notSkipped(app) {\n    return app.status !== SKIP_BECAUSE_BROKEN;\n}\n\nexport function withoutLoadError(app) {\n    return app.status !== LOAD_ERROR;\n}\n\nexport function isLoaded(app) {\n    return app.status !== NOT_LOADED && app.status !== LOAD_ERROR && app.status !== LOAD_RESOURCE_CODE;\n}\n\nexport function isntLoaded(app) {\n    return !isLoaded(app);\n}\n\nexport function isActive(app) {\n    return app.status === MOUNTED;\n}\n\nexport function isntActive(app) {\n    return !isActive(app)\n}\n\nexport function shouldBeActive(app) {\n    try {\n        return app.activityWhen(window.location);\n    } catch (e) {\n        app.status = SKIP_BECAUSE_BROKEN;\n        throw e;\n    }\n}\n\nexport function shouldntBeActive(app) {\n    try {\n        return !app.activityWhen(window.location);\n    } catch (e) {\n        app.status = SKIP_BECAUSE_BROKEN;\n        throw e;\n    }\n}","\nimport {invoke} from './navigation/invoke';\n\nlet started = false;\n\nexport function start() {\n    if (started) {\n        return;\n    }\n    started = true;\n    return invoke();\n}\n\nexport function isStarted() {\n    return started;\n}","\n\nimport {NOT_BOOTSTRAPPED, BOOTSTRAPPING, NOT_MOUNTED, SKIP_BECAUSE_BROKEN} from \"../applications/app.helper\";\nimport {reasonableTime} from '../applications/timeouts';\nimport {getProps} from './helper';\n\nexport function toBootstrapPromise(app) {\n    if (app.status !== NOT_BOOTSTRAPPED) {\n        return Promise.resolve(app);\n    }\n\n    app.status = BOOTSTRAPPING;\n\n    return reasonableTime(app.bootstrap(getProps(app)), `app: ${app.name} bootstrapping`, app.timeouts.bootstrap).then(() => {\n        app.status = NOT_MOUNTED;\n        return app;\n    }).catch(e => {\n        console.log(e);\n        app.status = SKIP_BECAUSE_BROKEN;\n        return app;\n    });\n}","\nimport {MOUNTED, NOT_MOUNTED, SKIP_BECAUSE_BROKEN, UNMOUNTING} from \"../applications/app.helper\";\nimport {reasonableTime} from \"../applications/timeouts\";\nimport {getProps} from \"./helper\";\n\nexport function toUnmountPromise(app) {\n    if (app.status !== MOUNTED) {\n        return Promise.resolve(app);\n    }\n    app.status = UNMOUNTING;\n\n    function unmountThisApp(serviceUnmountError) {\n        return reasonableTime(app.unmount(getProps(app)), `app: ${app.name} unmounting`, app.timeouts.unmount).catch(e => {\n            console.log(e);\n            app.status = SKIP_BECAUSE_BROKEN;\n        }).then(() => {\n            if (app.status !== SKIP_BECAUSE_BROKEN) {\n                app.status = serviceUnmountError === true ? SKIP_BECAUSE_BROKEN : NOT_MOUNTED;\n            }\n            return app;\n        });\n    }\n\n    // 优先卸载当前app中的service，如果存在的话\n    let unmountServicePromise = Promise.all(Object.keys(app.services).map(name => app.services[name].unmountSelf()));\n\n    return unmountServicePromise.catch(e => {\n        console.log(e);\n        return true;\n    }).then(unmountThisApp);\n}\n","\nimport {MOUNTED, NOT_MOUNTED, SKIP_BECAUSE_BROKEN,MOUNTING} from \"../applications/app.helper\";\nimport {reasonableTime} from \"../applications/timeouts\";\nimport {getProps} from \"./helper\";\nimport {toUnmountPromise} from './unmount';\n\nexport function toMountPromise(app) {\n  if (app.status !== NOT_MOUNTED) {\n      return Promise.resolve(app);\n  }\n  app.status = MOUNTING;\n  return reasonableTime(app.mount(getProps(app)), `app: ${app.name} mounting`, app.timeouts.mount).then(() => {\n    app.status = MOUNTED;\n  }).catch(e => {\n    console.log(e);\n    app.status = MOUNTED;\n\n    return toUnmountPromise(app).catch(e => {\n        console.log(e);\n    }).then(() => {\n        app.status = SKIP_BECAUSE_BROKEN;\n        return app;\n    });\n  })\n}\n","\nimport {MOUNTED, SKIP_BECAUSE_BROKEN, UPDATING} from \"../applications/app.helper\";\nimport {reasonableTime} from \"../applications/timeouts\";\nimport {getProps} from './helper';\n\nexport function toUpdatePromise(service) {\n    if (service.status !== MOUNTED) {\n        return Promise.resolve(service);\n    }\n\n    service.status = UPDATING;\n    return reasonableTime(service.update(getProps(service)), `service: ${service.name} updating`, service.timeouts.mount).then(() => {\n        service.status = MOUNTED;\n        return service;\n    }).catch(e => {\n        console.log(e);\n        service.status = SKIP_BECAUSE_BROKEN;\n        return service;\n    });\n}\n","\nimport {flattenFnArray, smellLikeAPromise, validateLifeCyclesFn} from \"../lifecycles/helper\";\nimport {\n    LOAD_RESOURCE_CODE,\n    MOUNTED,\n    NOT_BOOTSTRAPPED,\n    SKIP_BECAUSE_BROKEN\n} from '../applications/app.helper';\nimport {ensureAppTimeouts} from \"../applications/timeouts\";\nimport {toBootstrapPromise} from '../lifecycles/bootstrap';\nimport {toMountPromise} from '../lifecycles/mount';\nimport {toUnmountPromise} from '../lifecycles/unmount';\nimport {toUpdatePromise} from '../lifecycles/update';\n\n\nlet serviceIndex = 0;\n\nconst systemService = {services: {}};\n\n/**\n * 挂载系统服务\n * @return {{mount(): Promise, unmount(): Promise, update(Object): Promise, getStatus(): string}}\n */\nexport function mountSystemService() {\n    return mountService.apply(systemService, arguments);\n}\n\n/**\n * 根据名称获取系统服务\n * @param {string} serviceName 系统服务名称\n * @return {*|null}\n */\nexport function getSystemService(serviceName) {\n    return systemService[serviceName] || {};\n}\n\n/**\n * 挂载服务\n * @param {Object|Function<Promise>} config 服务配置或加载函数\n * @param {Object} props 传入服务的属性\n * @return {{mount(): Promise, unmount(): Promise, update(Object): Promise, getStatus(): string}}\n */\nexport function mountService(config, props = {}) {\n    if (!config || !/^(object|function)$/.test(typeof config)) {\n        throw new Error('cannot mount services without config or config load function');\n    }\n\n    const context = this;\n    serviceIndex++;\n\n    let loadServicePromise = typeof config === 'function' ? config() : () => Promise.resolve(config);\n\n    if (!smellLikeAPromise(loadServicePromise)) {\n        throw new Error('config load function must be a promise or thenable');\n    }\n\n    const service = {\n        id: serviceIndex,\n        // service 可以嵌套 service\n        services: {},\n        status: LOAD_RESOURCE_CODE,\n        props,\n        context\n    };\n\n\n    loadServicePromise = loadServicePromise.then(serviceConfig => {\n        let errorMsg = [];\n        const name = `service_${service.id}`;\n\n        if (typeof serviceConfig !== 'object') {\n            errorMsg.push(`service load function dose not export anything`);\n        }\n\n        ['bootstrap', 'mount', 'unmount', 'update'].forEach(lifecycle => {\n            // update是可选的\n            if (lifecycle === 'update' && !serviceConfig[lifecycle]) {\n                return;\n            }\n            if (!validateLifeCyclesFn(serviceConfig[lifecycle])) {\n                errorMsg.push(`service dost not export ${lifecycle} as a function or function array`);\n            }\n        });\n\n        if (errorMsg.length) {\n            service.status = SKIP_BECAUSE_BROKEN;\n            throw new Error(errorMsg.toString());\n        }\n\n        service.name = name;\n        service.status = NOT_BOOTSTRAPPED;\n        service.bootstrap = flattenFnArray(serviceConfig.bootstrap, `service bootstrap functions`);\n        service.mount = flattenFnArray(serviceConfig.mount, `service mount functions`);\n        service.unmount = flattenFnArray(serviceConfig.unmount, `service unmount functions`);\n        service.timeouts = ensureAppTimeouts(serviceConfig.timeouts);\n\n        if (serviceConfig.update) {\n            service.update = flattenFnArray(serviceConfig.update, 'service update functions');\n        }\n\n    });\n\n    loadServicePromise = loadServicePromise.then(() => toBootstrapPromise(service));\n\n    let actions = {\n        mount() {\n            return loadServicePromise.then(() => {\n                context.services[service.name] = service;\n                return toMountPromise(service);\n            }).then(() => {\n                if (service.status !== MOUNTED) {\n                    delete context.services[service.name];\n                }\n            });\n        },\n        unmount() {\n            return toUnmountPromise(service).then(() => {\n                delete context.services[service.name];\n            });\n        },\n        update(props = {}) {\n            service.props = props;\n            return toUpdatePromise(service)\n        },\n        getStatus() {\n            return service.status;\n        },\n        getRawData() {\n            return {...service};\n        }\n    };\n\n    service.unmountSelf = actions.unmount;\n    service.mountSelf = actions.mount;\n    service.updateSelf = actions.update;\n\n    return actions;\n\n}\n","\nimport * as mySingleSpa from '../my-single-spa';\nimport {mountService} from \"../services\";\n\nexport function getProps(app) {\n    return {\n        ...app.customProps,\n        name: app.name,\n        // 将此方法传入app中，让app可以在内部自由挂载服务\n        mountService: mountService.bind(app),\n        mySingleSpa\n    };\n}\n\nexport function smellLikeAPromise(promise) {\n    if (promise instanceof Promise) {\n        return true;\n    }\n    return typeof promise === 'object' && promise.then === 'function' && promise.catch === 'function';\n}\n\nexport function validateLifeCyclesFn(fn) {\n    if (typeof fn === 'function') {\n        return true;\n    }\n    if (Array.isArray(fn)) {\n        return fn.filter(item => typeof item !== 'function').length === 0;\n    }\n    return false;\n}\n\nexport function flattenFnArray(fns, description) {\n    if (!Array.isArray(fns)) {\n        fns = [fns];\n    }\n\n    if (fns.length === 0) {\n        fns = [() => Promise.resolve()];\n    }\n\n    return function (props) {\n        return new Promise((resolve, reject) => {\n            waitForPromises(0);\n\n            function waitForPromises(index) {\n                let fn = fns[index](props);\n                if (!smellLikeAPromise(fn)) {\n                    reject(`${description} at index ${index} did not return a promise`);\n                    return;\n                }\n                fn.then(() => {\n                    if (index === fns.length - 1) {\n                        resolve();\n                    } else {\n                        waitForPromises(++index);\n                    }\n                }).catch((e) => {\n                    reject(e);\n                });\n            }\n\n        });\n    }\n}","import {\n  LOAD_ERROR,\n  LOAD_RESOURCE_CODE,\n  NOT_LOADED,\n  SKIP_BECAUSE_BROKEN,\n  NOT_BOOTSTRAPPED\n} from '../applications/app.helper';\n\nimport {getProps, smellLikeAPromise, validateLifeCyclesFn, flattenFnArray} from './helper';\n\nimport {ensureAppTimeouts} from '../applications/timeouts';\n\nexport function toLoadPromise(app) {\n  // 状态不满足需要被load\n  if (app.status !== NOT_LOADED && app.status !== LOAD_ERROR) {\n      return Promise.resolve(app);\n  }\n\n  app.status = LOAD_RESOURCE_CODE;\n\n  const loadPromise = app.loadApp(getProps(app));\n\n  if (!smellLikeAPromise(loadPromise)) {\n      console.log('app loadFunction must return a promise');\n      app.status = SKIP_BECAUSE_BROKEN;\n      return Promise.resolve(app);\n  }\n\n  return loadPromise.then(module => {\n      let errorMsg = [];\n\n      if (typeof module !== 'object') {\n          errorMsg.push(`app:${app.name} dose not export anything`);\n      }\n\n      ['bootstrap', 'mount', 'unmount'].forEach(lifecycle => {\n          if (!validateLifeCyclesFn(module[lifecycle])) {\n              errorMsg.push(`app:${app.name} dost not export ${lifecycle} as a function or function array`);\n          }\n      });\n\n      if (errorMsg.length) {\n          console.log(errorMsg);\n          app.status = SKIP_BECAUSE_BROKEN;\n          return app;\n      }\n\n      app.status = NOT_BOOTSTRAPPED;\n      app.bootstrap = flattenFnArray(module.bootstrap, `app:${app.name} bootstrap functions`);\n      app.mount = flattenFnArray(module.mount, `app:${app.name} mount functions`);\n      app.unmount = flattenFnArray(module.unmount, `app:${app.name} unmount functions`);\n      app.unload = flattenFnArray(module.unload ? module.unload : [], `app:${app.name} unload functions`);\n      app.timeouts = ensureAppTimeouts(module.timeouts);\n\n\n      return app;\n\n  }).catch(e => {\n      console.log(e);\n      app.status = LOAD_ERROR;\n      return app;\n  });\n\n}\n","import {invoke} from \"./invoke\";\n\nconst HIJACK_EVENTS_NAME = /^(hashchange|popstate)$/i;\nconst EVENTS_POOL = {\n    hashchange: [],\n    popstate: []\n};\n\nfunction reroute() {\n    invoke([], arguments);\n}\n\nwindow.addEventListener('hashchange', reroute);\nwindow.addEventListener('popstate', reroute);\n\n// 拦截所有注册的事件，以便确保这里的事件总是第一个执行\nconst originalAddEventListener = window.addEventListener;\nconst originalRemoveEventListener = window.removeEventListener;\nwindow.addEventListener = function (eventName, handler, args) {\n    if (eventName && HIJACK_EVENTS_NAME.test(eventName) && typeof handler === 'function') {\n        EVENTS_POOL[eventName].indexOf(handler) === -1 && EVENTS_POOL[eventName].push(handler);\n    }\n    return originalAddEventListener.apply(this, arguments);\n};\n\nwindow.removeEventListener = function (eventName, handler) {\n    if (eventName && HIJACK_EVENTS_NAME.test(eventName) && typeof handler === 'function') {\n        let eventList = EVENTS_POOL[eventName];\n        eventList.indexOf(handler) > -1 && (EVENTS_POOL[eventName] = eventList.filter(fn => fn !== handler));\n    }\n    return originalRemoveEventListener.apply(this, arguments);\n};\n\n\n// 拦截history的方法，因为pushState和replaceState方法并不会触发onpopstate事件，所以我们即便在onpopstate时执行了reroute方法，也要在这里执行下reroute方法。\nconst originalHistoryPushState = window.history.pushState;\nconst originalHistoryReplaceState = window.history.replaceState;\nwindow.history.pushState = function (state, title, url) {\n    let result = originalHistoryPushState.apply(this, arguments);\n    reroute(mockPopStateEvent(state));\n    return result;\n};\nwindow.history.replaceState = function (state, title, url) {\n    let result = originalHistoryReplaceState.apply(this, arguments);\n    reroute(mockPopStateEvent(state));\n    return result;\n};\n\nfunction mockPopStateEvent(state) {\n    return new PopStateEvent('popstate', {state});\n}\n\n// 再执行完load、mount、unmout操作后，执行此函数，就可以保证微前端的逻辑总是第一个执行。然后App中的Vue或React相关Router就可以收到Location的事件了。\nexport function callCapturedEvents(eventArgs) {\n    if (!eventArgs) {\n        return;\n    }\n    if (Array.isArray(eventArgs)) {\n        eventArgs = eventArgs[0];\n    }\n    let name = eventArgs.type;\n    if (!HIJACK_EVENTS_NAME.test(name)) {\n        return;\n    }\n    EVENTS_POOL[name].forEach(handler => handler.apply(window, eventArgs));\n}\n\n","\nimport {getAppsToLoad, getAppsToMount, getAppsToUnmount, getMountedApps} from '../applications/apps';\nimport { isStarted } from \"../start\";\nimport {toLoadPromise} from '../lifecycles/load';\nimport {toBootstrapPromise} from '../lifecycles/bootstrap';\nimport {toMountPromise} from '../lifecycles/mount';\nimport {toUnmountPromise} from '../lifecycles/unmount';\nimport {callCapturedEvents} from './hijackLocations';\n\nlet loadAppsUnderway = false;\nlet pendingPromises = [];\n\nexport function invoke(pendings, eventArgs) {\n  if (loadAppsUnderway) {\n    return new Promise((resolve, reject) => {\n        pendingPromises.push({success: resolve, failure: reject, eventArgs});\n    });\n  }\n\n  loadAppsUnderway = true\n\n  if (isStarted()) {\n    return performAppChanges()\n  }\n\n  return loadApps()\n\n  // 找到需要load的app\n  function loadApps() {\n    let loadPromises = getAppsToLoad().map(toLoadPromise);\n    return Promise.all(loadPromises).then(() => {\n        callAllLocationEvents();\n        return finish();\n    }).catch(e => {\n        callAllLocationEvents();\n        console.log(e);\n    });\n  }\n\n  function finish() {\n    let resolveValue = getMountedApps();\n    if (pendings) {\n        pendings.forEach(item => item.success(resolveValue));\n    }\n\n    loadAppsUnderway = false;\n\n    if (pendingPromises.length) {\n        const backup = pendingPromises;\n        pendingPromises = [];\n        return invoke(backup);\n    }\n\n    return resolveValue;\n  }\n\n  // 启动app\n  function performAppChanges() {\n    // getAppsToUnmount\n    let unmountApps = getAppsToUnmount();\n    let unmountPromises = Promise.all(unmountApps.map(toUnmountPromise));\n\n    // getAppsToLoad\n    let loadApps = getAppsToLoad();\n    let loadPromises = loadApps.map(app => {\n        return toLoadPromise(app).then(app => toBootstrapPromise(app))\n            .then(() => unmountPromises).then(() => toMountPromise(app))\n    });\n\n    let mountApps = getAppsToMount().filter(app => loadApps.indexOf(app) === -1);\n    let mountPromises = mountApps.map(app => {\n        return toBootstrapPromise(app).then(() => unmountPromises).then(() => toMountPromise(app));\n    });\n\n    return unmountPromises.then(() => {\n        callAllLocationEvents();\n        let loadAndMountPromises = loadPromises.concat(mountPromises);\n        return Promise.all(loadAndMountPromises).then(finish, ex => {\n            pendings.forEach(item => item.reject(ex));\n            throw ex;\n        });\n    }, e => {\n        callAllLocationEvents();\n        console.log(e);\n        throw e;\n    });\n  }\n\n\n  function callAllLocationEvents() {\n    pendings && pendings.length && pendings.filter(item => item.eventArgs).forEach(item => callCapturedEvents(item.eventArgs));\n    eventArgs && callCapturedEvents(eventArgs);\n  }\n}\n\n","\nimport {\n  NOT_LOADED,\n  notSkipped,\n  withoutLoadError,\n  isntLoaded,\n  shouldBeActive,\n  shouldntBeActive,\n  isLoaded,\n  isntActive,\n  isActive\n} from './app.helper';\nimport {invoke} from '../navigation/invoke'\n\nconst APPS = [];\n\n/**\n * 获取满足加载条件的app\n * 1、没有加载中断\n * 2、没有加载错误\n * 3、没有被加载过\n * 4、满足app.activityWhen()\n * @return {*[]}\n */\nexport function getAppsToLoad() {\n  return APPS.filter(notSkipped).filter(withoutLoadError).filter(isntLoaded).filter(shouldBeActive);\n}\n\n/**\n * 需要mount的app\n * 1、没有加载中断\n * 2、加载过的\n * 3、当前没有mounted的\n * 4、需要被mounted的\n */\nexport function getAppsToMount() {\n  return APPS.filter(notSkipped).filter(isLoaded).filter(isntActive).filter(shouldBeActive);\n}\n\n/**\n * 需要被unmount的app\n * 1、没有加载中断\n * 2、正在挂载的\n * 3、需要卸载的\n */\nexport function getAppsToUnmount() {\n  return APPS.filter(notSkipped).filter(isActive).filter(shouldntBeActive);\n}\n\n/**\n * 获取所有的App名称\n * @return {string[]}\n */\nexport function getAppNames() {\n  return APPS.map(function (item) {\n      return item.name;\n  });\n}\n\nexport function getAppStatus(name) {\n  if (!name) {\n      return APPS.map(item => item.status);\n  }\n  let app = APPS.find(item => item.name === name);\n  return app ? app.status : null;\n}\n\nexport function getRawApps() {\n    return [...APPS];\n}\n\nexport function getMountedApps() {\n  return APPS.filter(isActive).map(item => item.name);\n}\n\n/**\n * 注册application\n * @param {string} appName application名称\n * @param {Object|Function<Promise>} applicationOrLoadFunction app配置或app异步加载函数\n * @param {Function<Boolean>} activityWhen 判断是否应该被挂载\n * @param {Object} customProps 自定义配置\n * @return {Promise}\n */\nexport function registerApplication(appName, applicationOrLoadFunction, activityWhen, customProps = {}) {\n  if (!appName || typeof appName !== 'string') {\n      throw new Error('the app name must be a non-empty string');\n  }\n  if (getAppNames().indexOf(appName) !== -1) {\n      throw new Error('There is already an app declared with name ' + appName);\n  }\n  if (typeof customProps !== 'object' || Array.isArray(customProps)) {\n      throw new Error('the customProps must be a pure object');\n  }\n\n  if (!applicationOrLoadFunction) {\n      throw new Error('the application or load function is required');\n  }\n\n  if (typeof activityWhen !== 'function') {\n      throw new Error('the activityWhen must be a function');\n  }\n\n  if (typeof applicationOrLoadFunction !== 'function') {\n      applicationOrLoadFunction = () => Promise.resolve(applicationOrLoadFunction);\n  }\n\n  APPS.push({\n      name: appName,\n      loadApp: applicationOrLoadFunction,\n      activityWhen,\n      customProps,\n      status: NOT_LOADED,\n      services: {}\n  });\n\n  return invoke();\n}"],"names":["DEFAULT_TIMEOUTS","bootstrap","milliseconds","rejectWhenTimeout","mount","unmount","unload","setBootstrapMaxTime","Error","type","setMountMaxTime","setUnmountMaxTime","setUnloadMaxTime","ensureAppTimeouts","timeouts","reasonableTime","promise","description","Promise","resolve","reject","finished","then","data","catch","e","setTimeout","maybeTimeout","error","console","NOT_LOADED","LOAD_RESOURCE_CODE","NOT_BOOTSTRAPPED","BOOTSTRAPPING","NOT_MOUNTED","MOUNTING","MOUNTED","UNMOUNTING","SKIP_BECAUSE_BROKEN","LOAD_ERROR","UPDATING","notSkipped","app","status","withoutLoadError","isLoaded","isntLoaded","isActive","isntActive","shouldBeActive","activityWhen","window","location","shouldntBeActive","started","start","invoke","isStarted","toBootstrapPromise","getProps","name","log","toUnmountPromise","unmountThisApp","serviceUnmountError","unmountServicePromise","all","Object","keys","services","map","unmountSelf","toMountPromise","toUpdatePromise","service","update","serviceIndex","systemService","mountSystemService","mountService","apply","arguments","getSystemService","serviceName","config","props","test","context","loadServicePromise","smellLikeAPromise","id","serviceConfig","errorMsg","push","forEach","lifecycle","validateLifeCyclesFn","length","toString","flattenFnArray","actions","getStatus","getRawData","mountSelf","updateSelf","customProps","bind","mySingleSpa","fn","Array","isArray","filter","item","fns","waitForPromises","index","toLoadPromise","loadPromise","loadApp","module","HIJACK_EVENTS_NAME","EVENTS_POOL","hashchange","popstate","reroute","addEventListener","originalAddEventListener","originalRemoveEventListener","removeEventListener","eventName","handler","args","indexOf","eventList","originalHistoryPushState","history","pushState","originalHistoryReplaceState","replaceState","state","title","url","result","mockPopStateEvent","PopStateEvent","callCapturedEvents","eventArgs","loadAppsUnderway","pendingPromises","pendings","success","failure","performAppChanges","loadApps","loadPromises","getAppsToLoad","callAllLocationEvents","finish","resolveValue","getMountedApps","backup","unmountApps","getAppsToUnmount","unmountPromises","mountApps","getAppsToMount","mountPromises","loadAndMountPromises","concat","ex","APPS","getAppNames","getAppStatus","find","getRawApps","registerApplication","appName","applicationOrLoadFunction"],"mappings":"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"}